@model IEnumerable<Training.MvcFrontend.Models.ListProductsViewModel>

@{
    ViewBag.Title = "GetAllProducts";
}

<h2>GetAllProducts</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>

@*@using (Html.BeginForm("GetFilteredProducts", "Products"))
    {
        <input type="text" id="minPrice" name="minPrice" />
        <input type="text" id="maxPrice" name="maxPrice" />
        <input type="submit" value="Filter!" class="btn btn-primary" />
    }*@

@{ 
    var ajaxOptions = new AjaxOptions
    {
        AllowCache = false,
        HttpMethod = "GET",
        OnSuccess = "showResults",
        OnFailure = "showError"
    };
}

@using (Ajax.BeginForm("GetFilteredProducts", "Products", ajaxOptions))
{
    <input type="text" id="minPrice" name="minPrice" />
    <input type="text" id="maxPrice" name="maxPrice" />
    <input type="submit" value="Filter!" class="btn btn-primary" />
}

<table class="table" id="resultItems">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.ProductId)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.CategoryId)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ProductName)
        </th>
        <th></th>
    </tr>
    <tbody id="resultBody">
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.ProductId)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CategoryId)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ProductName)
                </td>

            </tr>
        }
    </tbody>

</table>

@* Javascriptben 2 methodus írása (showResult és showError) *@
@section scripts {
    <script type="text/javascript">
        function showResults(data) {
            //console.log(data);
            var tbody = $("#resultBody");
            tbody.empty();
            for (var i = 0; i < data.length; i++) {
                var product = data[i];
                var newRow = "<tr><td>" + product.productId +
                    "</td><td>" + product.CategoryId +
                    "</td><td>" + product.CategoryName +
                    "</td></tr>";
                tbody.append(newRow);
            }
        }
        function showError() {
            console.log("Error");
        }
    </script>
    }
